# Tennis Ball Spin WebApp - 产品需求文档 (PRD)

## 1. 项目概述

- **项目名称**：Tennis Ball Spin WebApp（网球旋转无线仪表盘）
- **目标**：将 M5Stack ATOM S3 的 IMU 数据通过 WiFi 实时推送到浏览器，实现大屏可视化分析，让教练和球员能够在手机或电脑上直观地观察网球旋转状态、转速及运动轨迹数据。
- **核心方案**：ESP32-S3 WiFi AP 模式 + WebSocket 实时通信 + 纯前端 Canvas 渲染
- **适用场景**：网球训练场地、室内击球分析、旋转教学演示

---

## 2. 系统架构

整个系统采用 ATOM S3 作为独立 WiFi 热点，无需依赖外部路由器，手机或电脑直接连接即可使用。

```
ATOM S3 (WiFi AP: "TennisBall_IMU")
    ├── HTTP Server (port 80) → 提供嵌入式网页（HTML/CSS/JS 全部存储在固件中）
    └── WebSocket Server (port 81) → 推送 IMU 数据 (50Hz JSON)
         │
    手机/电脑浏览器连接 WiFi → 打开 192.168.4.1
         │
    网页接收 WebSocket 数据 → Canvas 实时渲染
```

**数据流说明**：

1. ATOM S3 以 50Hz 频率读取 MPU6886 陀螺仪和加速度计原始数据
2. 固件内部进行四元数积分，计算当前姿态和转速（RPM）
3. 数据打包为 JSON 格式，通过 WebSocket 推送到所有已连接的浏览器客户端
4. 浏览器前端解析 JSON，驱动 3D 网球渲染、实时曲线图表和数值显示
5. 用户可在浏览器端录制数据并导出为 CSV 文件，也可发送命令重置四元数

---

## 3. 硬件规格

| 项目 | 规格 |
|------|------|
| 主控模块 | M5Stack ATOM S3 |
| 处理器 | ESP32-S3，双核 Xtensa LX7，主频 240MHz |
| IMU 传感器 | MPU6886（6 轴：3 轴加速度计 + 3 轴陀螺仪） |
| 屏幕 | 128x128 彩色 LCD |
| WiFi | 802.11 b/g/n，2.4GHz，支持 AP 模式 |
| 按键 | 正面 BtnA（可编程按键） |
| 供电 | USB-C 或锂电池 |

**ATOM S3 屏幕显示内容**：

- WiFi SSID 名称
- 设备 IP 地址（192.168.4.1）
- 当前已连接客户端数量
- 实时 RPM 转速数值

---

## 4. 固件功能

### 4.1 WiFi AP 模式

- SSID：`TennisBall_IMU`
- 密码：`tennis123`
- IP 地址：`192.168.4.1`（ESP32 AP 模式默认网关）
- 最大同时连接设备数：4 台（WiFi 层面）

### 4.2 HTTP 服务器

- 监听端口：80
- 提供完整的网页仪表盘（HTML + CSS + JavaScript）
- 网页代码以 PROGMEM raw string literal 形式嵌入固件，无需外部文件系统
- 访问 `http://192.168.4.1/` 即可加载完整仪表盘页面

### 4.3 WebSocket 服务器

- 监听端口：81
- 推送频率：50Hz（每 20ms 一包）
- 数据格式：JSON（详见第 5 节数据协议）
- 支持接收客户端命令（如重置四元数）
- 最大同时 WebSocket 客户端数：3

### 4.4 IMU 数据处理

- 陀螺仪读取：X/Y/Z 三轴角速度（单位：°/s）
- 加速度计读取：X/Y/Z 三轴加速度（单位：g）
- 四元数积分：基于陀螺仪数据实时积分计算姿态四元数
- RPM 计算：由角速度合成向量计算转速（转/分钟）

### 4.5 ATOM S3 屏幕显示

利用 128x128 彩色 LCD 显示关键运行状态：

- 第一行：WiFi SSID（`TennisBall_IMU`）
- 第二行：IP 地址（`192.168.4.1`）
- 第三行：已连接客户端数量（如 `Clients: 2`）
- 第四行：当前实时 RPM（如 `1250 RPM`）

### 4.6 按键功能

- **BtnA 短按**：重置四元数为初始状态（单位四元数 [1, 0, 0, 0]），将当前姿态归零

---

## 5. 数据协议

### 5.1 WebSocket 推送数据（服务器 → 客户端）

JSON 格式，每 20ms 推送一包：

```json
{
  "t": 12345,
  "ax": 0.01,
  "ay": 0.02,
  "az": 1.00,
  "gx": 120.5,
  "gy": -45.2,
  "gz": 890.1,
  "qw": 0.99,
  "qx": 0.01,
  "qy": 0.02,
  "qz": 0.03,
  "rpm": 150
}
```

**字段说明**：

| 字段 | 类型 | 单位 | 说明 |
|------|------|------|------|
| `t` | int | ms | 设备启动以来的时间戳（millis） |
| `ax` | float | g | 加速度计 X 轴 |
| `ay` | float | g | 加速度计 Y 轴 |
| `az` | float | g | 加速度计 Z 轴 |
| `gx` | float | °/s | 陀螺仪 X 轴角速度 |
| `gy` | float | °/s | 陀螺仪 Y 轴角速度 |
| `gz` | float | °/s | 陀螺仪 Z 轴角速度 |
| `qw` | float | - | 四元数 w 分量 |
| `qx` | float | - | 四元数 x 分量 |
| `qy` | float | - | 四元数 y 分量 |
| `qz` | float | - | 四元数 z 分量 |
| `rpm` | int | RPM | 转速（转/分钟） |

### 5.2 WebSocket 命令（客户端 → 服务器）

客户端可通过 WebSocket 发送纯文本命令：

| 命令 | 说明 |
|------|------|
| `RESET` | 重置四元数为初始状态 |

---

## 6. 网页仪表盘功能

### 6.1 3D 网球可视化

- 使用 Canvas 2D API 渲染网球模型
- 绘制网球的绿色球体和白色缝线图案
- 基于四元数数据实时旋转缝线，与物理设备姿态同步
- 在球体下方显示旋转类型标签（TOPSPIN / BACKSPIN / SIDESPIN / FLAT）

### 6.2 陀螺仪实时曲线

- X/Y/Z 三轴滚动折线图
- X 轴为红色、Y 轴为绿色、Z 轴为蓝色
- 数据窗口：最近 250 个数据点（约 5 秒）
- 实时滚动更新，自动缩放 Y 轴范围
- 单位标注：°/s

### 6.3 加速度实时曲线

- X/Y/Z 三轴滚动折线图
- 配色与陀螺仪图表一致（红/绿/蓝）
- 数据窗口：最近 250 个数据点（约 5 秒）
- 实时滚动更新，自动缩放 Y 轴范围
- 单位标注：g

### 6.4 RPM 数字显示

- 大字号显示当前实时转速数值
- 显示旋转类型标签（基于三轴角速度分量占比判断）
- 旋转类型分类逻辑：
  - **TOPSPIN**：gx 为主导分量且为正
  - **BACKSPIN**：gx 为主导分量且为负
  - **SIDESPIN**：gy 或 gz 为主导分量
  - **FLAT**：RPM 低于阈值

### 6.5 连接状态指示

- 绿色圆点 + "Connected"：WebSocket 已连接
- 红色圆点 + "Disconnected"：WebSocket 断开
- 断开后自动重连（每 2 秒尝试一次）

### 6.6 操作按钮

- **录制开关（Record）**：点击开始记录数据到浏览器内存数组，再次点击停止录制
- **导出 CSV（Export CSV）**：将录制的数据下载为 CSV 文件，包含所有字段和表头
- **重置球（Reset）**：通过 WebSocket 发送 `RESET` 命令，重置设备端四元数

### 6.7 实现约束

- **纯前端实现**：HTML + CSS + JavaScript 全部写在一个文件中
- **无外部依赖**：不依赖任何 CDN 或第三方库，所有渲染逻辑手写实现
- **代码嵌入固件**：整个网页以 PROGMEM raw string literal 形式编译进固件
- **响应式布局**：适配手机竖屏和电脑横屏浏览

---

## Feature #2: 击球瞬间自动检测 (Impact Detection)

### 概述

利用加速度计数据的突变自动识别击球瞬间，无需用户手动标记。固件端负责检测逻辑，Web 端负责可视化呈现。

### 功能需求

- 利用加速度计突变（>4g 阈值）自动识别击球瞬间
- 记录击球前后的数据窗口，便于事后分析击球过程
- 击球事件通过 WebSocket 发送特殊 JSON 消息（与常规数据流区分）
- 固件端完成检测计算，Web 端接收事件后显示标记

### 检测算法

- **触发条件**：加速度向量幅值 `sqrt(ax² + ay² + az²) > 4.0g`
- **冷却期**：触发后加 200ms 冷却期，防止同一次击球重复触发
- **检测频率**：跟随 IMU 采样频率（50Hz），每次读取加速度数据时执行判断

### 击球记录内容

每次检测到击球事件时，记录以下信息：

| 字段 | 说明 |
|------|------|
| 时间戳 | 击球发生的设备时间（ms） |
| 峰值 RPM | 击球瞬间的最大转速 |
| 峰值 G 力 | 击球瞬间的最大加速度幅值 |
| 旋转类型 | 击球瞬间的旋转分类结果（见 Feature #3） |

### Web 端显示

- 击球瞬间在图表上显示竖直标记线
- 弹出短暂通知提示击球检测到
- 击球事件记入击球列表（见 Feature #8 时间线）

---

## Feature #3: 旋转类型智能分类 (Spin Classification)

### 概述

基于三轴陀螺仪数据的主导轴比例，自动将每次旋转分类为具体的旋转类型，帮助教练和球员快速理解球的旋转特征。

### 分类类型

| 类型 | 英文 | 说明 |
|------|------|------|
| 上旋 | TOPSPIN | 球向前翻转，产生下坠弧线 |
| 下旋 | BACKSPIN | 球向后翻转，产生漂浮弧线 |
| 侧旋 | SIDESPIN | 球水平旋转，产生左右偏移 |
| 平击 | FLAT | 几乎无旋转，直线飞行 |
| 切削 | SLICE | 球斜向旋转，产生侧切效果 |

### 分类算法

分类基于三轴陀螺仪读数（gx, gy, gz）的绝对值占比和符号方向：

1. **计算各轴绝对值占比**：
   - `ratio_x = |gx| / (|gx| + |gy| + |gz|)`
   - `ratio_y = |gy| / (|gx| + |gy| + |gz|)`
   - `ratio_z = |gz| / (|gx| + |gy| + |gz|)`

2. **分类判定规则**（按优先级排列）：
   - 若 RPM < 300 → 判定为 **FLAT**（平击）
   - 若主导轴占比 > 60%，判定单一类型：
     - **gx 主导**（ratio_x > 60%）：
       - gx 为正值 → **TOPSPIN**（上旋）
       - gx 为负值 → **BACKSPIN**（下旋）
     - **gy 主导**（ratio_y > 60%）→ **SIDESPIN**（侧旋）
     - **gz 主导**（ratio_z > 60%）→ **SLICE**（切削）
   - 若无单一主导轴 → 取绝对值最大的轴按上述规则判定

### 考虑因素

- 各轴占比用于区分旋转的主导方向
- 符号（正/负）用于区分上旋与下旋、左侧旋与右侧旋
- RPM 阈值用于过滤噪声，避免静止状态下产生误判

### Web 端显示

- 旋转类型以彩色标签形式显示在 3D 网球下方和 RPM 区域
- 各类型对应颜色建议：
  - TOPSPIN：橙色（#ff8800）
  - BACKSPIN：紫色（#aa44ff）
  - SIDESPIN：青色（#00cccc）
  - FLAT：灰色（#888888）
  - SLICE：黄绿色（#88cc00）

---

## Feature #8: 多球对比时间线 (Multi-Shot Timeline)

### 概述

录制一段练习后，以水平时间线形式展示所有击球事件，便于教练和球员回顾整段练习的击球质量和旋转变化趋势。

### 功能需求

- 录制一段练习后，以时间线形式展示所有击球事件
- 每个击球标记显示 RPM、旋转类型、峰值加速度
- 可选中某次击球查看详细数据
- 提供击球统计汇总信息

### 击球统计汇总

在时间线区域上方显示以下汇总数据：

| 统计项 | 说明 |
|--------|------|
| 总击球数 | 本次录制期间检测到的击球次数 |
| 平均 RPM | 所有击球的平均转速 |
| 最高 RPM | 所有击球中的最大转速 |
| 旋转类型分布 | 各旋转类型占比（如 TOPSPIN 60%，SIDESPIN 30%，FLAT 10%） |

### Web UI 布局

- 时间线位于 Web 页面底部区域
- 水平方向表示时间轴，从录制开始到结束
- 每次击球在时间轴上显示为一个圆形标记点
- 标记点颜色对应旋转类型（与 Feature #3 颜色方案一致）
- 标记点上方显示 RPM 数值

### 交互设计

- 点击击球标记弹出详情面板，显示该次击球的完整数据：
  - 击球时间（相对录制起始时间）
  - RPM 数值
  - 旋转类型
  - 峰值加速度（G 力）
  - gx / gy / gz 各轴角速度
- 详情面板可关闭
- 时间线支持水平滚动（当击球次数较多时）

---

## WebSocket 协议更新

### 常规数据流更新

在现有 WebSocket 推送数据包中新增 `imp` 字段，用于标识当前数据帧是否对应击球瞬间：

```json
{
  "t": 12345,
  "ax": 0.01, "ay": 0.02, "az": 1.00,
  "gx": 120.5, "gy": -45.2, "gz": 890.1,
  "qw": 0.99, "qx": 0.01, "qy": 0.02, "qz": 0.03,
  "rpm": 150,
  "imp": 1
}
```

- `"imp": 1`：当检测到击球时附带此字段，表示当前帧为击球帧
- 未检测到击球时，`imp` 字段省略或为 0，以节省带宽

### 新增击球事件消息

当固件端检测到击球事件时，额外发送一条独立的击球事件 JSON 消息：

```json
{
  "event": "shot",
  "id": N,
  "t": ms,
  "rpm": X,
  "type": "TOPSPIN",
  "peakG": Y,
  "gx": value,
  "gy": value,
  "gz": value
}
```

**字段说明**：

| 字段 | 类型 | 说明 |
|------|------|------|
| `event` | string | 事件类型，固定为 `"shot"` |
| `id` | int | 击球序号，从 1 开始递增，设备重启后归零 |
| `t` | int | 击球时间戳（设备 millis，单位 ms） |
| `rpm` | int | 击球瞬间峰值 RPM |
| `type` | string | 旋转类型分类结果（`TOPSPIN` / `BACKSPIN` / `SIDESPIN` / `FLAT` / `SLICE`） |
| `peakG` | float | 击球瞬间峰值 G 力（加速度向量幅值） |
| `gx` | float | 击球瞬间陀螺仪 X 轴角速度（°/s） |
| `gy` | float | 击球瞬间陀螺仪 Y 轴角速度（°/s） |
| `gz` | float | 击球瞬间陀螺仪 Z 轴角速度（°/s） |

---

## 7. 技术栈

### 7.1 固件端

| 组件 | 技术选型 | 说明 |
|------|----------|------|
| 开发框架 | Arduino (PlatformIO) | ESP32-S3 Arduino 核心 |
| 硬件抽象 | M5Unified | M5Stack 官方统一库，提供 IMU / 屏幕 / 按键接口 |
| WebSocket | WebSockets by links2004 | 轻量级 ESP32 WebSocket 服务器库 |
| HTTP 服务器 | WebServer (ESP32 内置) | 提供静态网页服务 |
| JSON 序列化 | ArduinoJson 或手动拼接 | 构造 IMU 数据 JSON 包 |

### 7.2 前端

| 组件 | 技术选型 | 说明 |
|------|----------|------|
| 3D 渲染 | HTML5 Canvas 2D API | 原生 Canvas，手写 3D 投影和四元数旋转 |
| 图表 | Vanilla JavaScript | 手写折线图渲染，无第三方图表库 |
| 通信 | WebSocket API | 浏览器原生 WebSocket (ws://192.168.4.1:81) |
| 样式 | 内联 CSS | 深色主题，响应式布局 |

### 7.3 通信协议

- WiFi：802.11n, 2.4GHz, AP 模式
- HTTP：端口 80，GET / 返回网页
- WebSocket：端口 81，ws://192.168.4.1:81，双向通信

### 7.4 网页嵌入方式

使用 C++ raw string literal 配合 PROGMEM 将整个网页存储在 Flash 中：

```cpp
const char index_html[] PROGMEM = R"rawliteral(
<!DOCTYPE html>
<html>
...整个网页代码...
</html>
)rawliteral";
```

---

## 8. UI 布局设计

### 8.1 网页整体布局

```
┌─────────────────────────────────────────────┐
│  TennisBall IMU          ●Connected         │  ← 顶部导航栏
├────────────────────┬────────────────────────┤
│                    │                        │
│   ┌────────────┐   │     1250 RPM           │  ← RPM 大字号显示
│   │ 3D Tennis  │   │     TOPSPIN            │  ← 旋转类型（彩色标签）
│   │   Ball     │   │                        │
│   │  (Canvas)  │   │  ┌─ Gyro Chart ─────┐  │
│   │  缝线随四元 │   │  │  X(red)          │  │  ← 陀螺仪实时曲线
│   │  数实时旋转 │   │  │  Y(green)        │  │
│   └────────────┘   │  │  Z(blue)         │  │
│                    │  └──────────────────┘  │
│  ┌──────────────┐  │  ┌─ Accel Chart ────┐  │
│  │  0 RPM       │  │  │  X(red)          │  │  ← 加速度实时曲线
│  │  RPM label   │  │  │  Y(green)        │  │
│  │  TOPSPIN     │  │  │  Z(blue)         │  │
│  └──────────────┘  │  └──────────────────┘  │
│                    │  ┌─ Current Values ──┐  │
│                    │  │ ax: 0.01  gx: 120 │  │  ← 实时数据面板
│                    │  │ ay: 0.02  gy: -45 │  │
│                    │  │ az: 1.00  gz: 890 │  │
│                    │  └──────────────────┘  │
├────────────────────┴────────────────────────┤
│ [●Record] [↓CSV] [↻Reset] [Clear Shots]    │  ← 操作栏
├─────────────────────────────────────────────┤
│  Shot Timeline                              │
│  ┌──────┐ ┌──────┐ ┌──────┐ ┌──────┐       │
│  │  0   │ │  85  │ │ 120  │ │  42  │       │  ← 统计汇总
│  │Shots │ │ Avg  │ │ Max  │ │ Max  │       │
│  │      │ │ RPM  │ │ RPM  │ │  G   │       │
│  └──────┘ └──────┘ └──────┘ └──────┘       │
│  ┌─────────────────────────────────────┐    │
│  │ ●120   ●85    ●150   ●90    ●110   │    │  ← 时间线标记点
│  │ TOP    SIDE   TOP    BACK   SLICE   │    │    （颜色按旋转类型）
│  └─────────────────────────────────────┘    │
│  ┌─ Shot Detail ───────────────────────┐    │
│  │  Shot #3 - TOPSPIN                  │    │  ← 点击标记弹出详情
│  │  RPM: 150  │ Peak G: 6.2 │ Type: T │    │
│  │  Gx: 120.5 │ Gy: -45.2  │ Gz: 8.1 │    │
│  └─────────────────────────────────────┘    │
└─────────────────────────────────────────────┘

击球检测时全屏红色闪烁覆盖层（150ms 淡出）
```

### 8.2 ATOM S3 屏幕布局（128x128 像素）

```
┌────────────────────────┐
│       1250 RPM         │  ← 大字号 RPM（顶部居中）
│    或  READY（静止时）   │
│                        │
│     ┌──────────┐       │
│     │ ○ Tennis │       │  ← 3D 网球（缝线随四元数旋转）
│     │   Ball   │       │     半径 30px，中心 (64, 52)
│     │  (seam)  │       │
│     └──────────┘       │
│                        │
│ ●2 connected  3 shots  │  ← 连接状态（绿点）+ 击球数（橙色）
│ TennisBall_IMU         │  ← WiFi SSID（灰色）
│ pw: tennis123          │  ← 密码（灰色）
│ 192.168.4.1            │  ← IP 地址（青色）
└────────────────────────┘
```

### 8.3 布局说明

- **顶部导航栏**：项目名称居左，连接状态指示灯居右
- **左侧区域**：3D 网球可视化（Canvas 300x300），下方显示 RPM + 旋转类型标签
- **右侧上方**：陀螺仪三轴实时折线图
- **右侧下方**：加速度三轴实时折线图 + 当前数值面板
- **操作栏**：录制、导出 CSV、重置球、清除击球 四个按钮
- **击球时间线**：统计汇总（4 个指标卡片）+ 水平可滚动时间线 + 点击展开详情面板
- **击球闪烁**：检测到击球时全屏红色半透明覆盖层闪烁 150ms
- **ATOM S3 屏幕**：旋转网球 + RPM + WiFi 信息 + 击球计数

### 8.4 配色方案

- 背景色：深色主题（#1a1a2e）
- 网球颜色：标准网球荧光黄绿色（#C8D820）
- 图表背景：半透明深色（rgba(0,0,0,0.3)）
- X 轴曲线：红色（#FF4444）
- Y 轴曲线：绿色（#44FF44）
- Z 轴曲线：蓝色（#4444FF）
- 连接状态：绿色（#44FF44）/ 红色（#FF4444）
- 文字颜色：白色（#e0e0e0）
- 按钮：圆角深色背景 + 亮色边框
- **旋转类型配色**：
  - TOPSPIN：珊瑚红（#FF6B6B）
  - BACKSPIN：青绿（#4ECDC4）
  - SIDESPIN / SIDE_L / SIDE_R：明黄（#FFE66D）
  - SLICE：薄荷绿（#A8E6CF）
  - FLAT：灰色（#888888）
  - MIXED：淡紫（#DDA0DD）

### 8.5 响应式适配

- **手机竖屏**：左右两栏改为上下排列（3D 球在上，图表在下）
- **电脑横屏**：左右两栏并排布局（如上图所示）
- 断点：768px
- 时间线区域支持水平滚动（击球标记超出可视宽度时）

---

## 9. 性能指标

| 指标 | 目标值 | 说明 |
|------|--------|------|
| WebSocket 推送频率 | 50Hz (20ms/包) | 固件端定时推送 |
| 网页渲染帧率 | ~30fps | 使用 requestAnimationFrame，数据到达时更新 |
| 图表数据窗口 | 250 个数据点 | 约 5 秒滚动窗口 |
| WiFi 延迟 | <10ms | AP 直连模式，无路由器中转 |
| 最大同时 WebSocket 客户端 | 3 | 避免 ESP32 内存溢出 |
| 网页总大小 | <50KB | 嵌入 PROGMEM，需控制体积 |
| 固件 Flash 占用 | <1.5MB | 含网页代码和所有库 |
| CSV 录制时长 | 取决于浏览器内存 | 前端内存数组存储，建议不超过 5 分钟 |

---

## 10. 使用流程

### 10.1 初始设置

1. 使用 PlatformIO 编译固件
2. 通过 USB-C 将固件烧录到 ATOM S3
3. 将 ATOM S3 安装/固定在网球上（或手持测试）

### 10.2 日常使用

1. **开机**：ATOM S3 上电，128x128 屏幕显示 WiFi SSID 和 IP 地址
2. **连接 WiFi**：手机或电脑连接 WiFi 热点 `TennisBall_IMU`，密码 `tennis123`
3. **打开仪表盘**：浏览器访问 `http://192.168.4.1`
4. **实时查看**：仪表盘自动连接 WebSocket，实时显示 3D 网球旋转、曲线图表和 RPM 数值
5. **录制数据**：点击 Record 按钮开始录制，再次点击停止
6. **导出数据**：点击 Export CSV 按钮，浏览器自动下载 CSV 文件
7. **重置姿态**：点击 Reset 按钮或按下 ATOM S3 正面按键，四元数归零

### 10.3 注意事项

- 连接 ATOM S3 的 WiFi 后，手机/电脑将无法访问互联网（AP 模式无外网）
- 建议在使用前先按 Reset 校准初始姿态
- 多个设备可同时连接查看，但建议不超过 3 个客户端以保证性能

---

## 11. 文件结构

```
ball_spin_webapp/
├── platformio.ini            # PlatformIO 项目配置
├── src/
│   └── main.cpp              # 固件主程序（WiFi AP + HTTP + WebSocket + IMU）
├── PRD.md                    # 本产品需求文档
└── README.md                 # 项目说明（如需要）
```

**main.cpp 核心模块划分**：

- WiFi AP 初始化与管理
- HTTP 服务器（提供 PROGMEM 网页）
- WebSocket 服务器（数据推送与命令接收）
- IMU 数据读取与四元数积分
- ATOM S3 屏幕刷新
- 按键事件处理
- 内嵌网页代码（PROGMEM HTML/CSS/JS）

---

## 12. 未来规划

### 12.1 短期优化

- 数据包压缩（MessagePack 替代 JSON，减少带宽占用）
- 网页加载进度提示
- 陀螺仪零偏自动校准

### 12.2 中期扩展

- **多传感器网络**：多个 ATOM S3 同时采集，汇聚到一个仪表盘展示
- **历史数据对比回放**：录制多次击球数据，在仪表盘上叠加对比分析
- **击球自动检测**：基于加速度突变检测击球瞬间，自动标记时间点
- **旋转分类算法**：使用机器学习或规则引擎自动分类旋转类型（上旋/下旋/侧旋）

### 12.3 长期愿景

- **PWA 离线缓存支持**：Service Worker 缓存网页，即使断开 WiFi 也能查看历史数据
- **蓝牙 BLE 备选通道**：在 WiFi 不可用时降级为 BLE 传输
- **云端数据同步**：连接外网时自动上传训练数据到云端
- **教练端多人监控**：一个教练端同时监控多名球员的实时旋转数据
